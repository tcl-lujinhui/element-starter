<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title></title>
  <script src="http://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
</head>

<body>
  <form role="form" name="files" method="post" enctype="multipart/form-data" id="form-fota" onsubmit="upload('#form-fota');return false">
    <div class="input-group input-item"><span for="filedata" style="width:100px" class="input-group-addon">File input</span>
      <input type="file" id="file" name="file" class="form-control">
    </div>
    <div class="input-group input-item"><span style="width:100px" class="input-group-addon">Info</span>
      <input type="text" id="info" name="info" placeholder="Info" class="form-contro form-control">
    </div>
    <div class="input-item">
      <button type="submit" class="btn btn-primary btn-block">Submit</button>
    </div>
  </form>
  <script>
  var serialize = function(form) {
    var $form, formData;
    formData = {};
    $form = $(form);
    $.each($(form).serializeArray(), function(i, v) {
      if (($(form).find("[name='" + v.name + "']")).attr('type') === 'radio') {
        return formData[v.name] = Number(v.value);
      } else {
        return formData[v.name] = v.value;
      }
    });
    $form.find("[trueval]").each(function() {
      var $this;
      $this = $(this);
      return formData[$this.attr('name')] = Number($this.prop('checked') ? $this.attr('trueval') : $this.attr('falseval'));
    });
    return formData;
  }
  var upload = function(form) {
    var $form, $formbodydata, $formdata, err, error, fileName, fileNameArr, fileVal, fileValArr, hw_version, options, sw_version, url;
    $form = $(form);
    $formbodydata = serialize(form);
    fileVal = $("#file").val();
    fileValArr = fileVal.split("\\");
    fileName = fileValArr[fileValArr.length - 1];
    fileNameArr = fileName.split("_");
    try {
      hw_version = fileNameArr[1].slice(2);
      sw_version = fileNameArr[2].slice(2);
    } catch (error1) {
      err = error1;
      alert("文件格式错误!");
      return;
    }
    if ($("#info").val() === "") {
      alert("请输入Info!")
      $("#info").focus();
      return;
    }
    try {
      $formdata = new FormData($form[0]);
      $formdata.append("hw_version", hw_version);
      $formdata.append("sw_version", sw_version);
      url = "/firmware/pub";
      options = {
        url: url,
        type: 'POST',
        data: $formdata,
        processData: false,
        contentType: false,
        complete: function() {
        },
        success: function(res) {
          console.log(res);
          alert("ok")
        },
        error: function(err) {
          console.log(err);
          alert("error")
        }
      };
      return $.ajax(options);
    } catch (error1) {
      alert("浏览器不支持，请使用IE10以上或Firefox、Chrome");
    }
  }
  </script>
</body>

</html>
